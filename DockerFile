FROM alpine:latest

# Install dependencies and Tailscale
RUN apk add --no-cache curl iptables bash ca-certificates \
    && curl -fsSL https://pkgs.tailscale.com/stable/alpine/tailscale-latest.apk -o tailscale.apk \
    && apk add --no-cache --allow-untrusted tailscale.apk \
    && rm tailscale.apk

# Run tailscaled in userspace networking mode with persistent state
CMD ["tailscaled", "--tun=userspace-networking", "--state=/var/lib/tailscale/tailscaled.state"]
